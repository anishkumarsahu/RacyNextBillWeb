{% extends 'home/index.html' %}
{% block title %}
    <title>Sales</title>
{% endblock %}
{% block body %}
    <style>
        .cwide {
            width: 73% !important;
        }

        .ui.search > .results {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            -webkit-transform-origin: center top;
            transform-origin: center top;
            white-space: normal;
            text-align: left;
            text-transform: none;
            background: #fff;
            margin-top: .5em;
            width: 25em;
            border-radius: .28571429rem;
            -webkit-box-shadow: 0 2px 4px 0 rgba(34, 36, 38, .12), 0 2px 10px 0 rgba(34, 36, 38, .15);
            box-shadow: 0 2px 4px 0 rgba(34, 36, 38, .12), 0 2px 10px 0 rgba(34, 36, 38, .15);
            border: 1px solid #d4d4d5;
            z-index: 998;
        }

        .ui.search > .results .result {
            cursor: pointer;
            display: block;
            overflow: hidden;
            font-size: 1.3em;
            padding: .85714286em 1.14285714em;
            color: rgba(0, 0, 0, .87);
            line-height: 1.33;
            border-bottom: 1px solid rgba(34, 36, 38, .1);
        }
    </style>
<div class="ui pointing secondary menu" style="margin-top: 0">
     <div style="cursor: pointer;" class="item active" data-tab="user">New Sales
                </div>
            </div>

    <div class="ui right aligned basic segment">
        <div class="ui internally grid">

            <div class="row" style="padding-bottom: 0!important;padding-top: 0!important;">
                <div class="sixteen wide tablet four wide computer column" style="margin-top: 2px">
                    <form class="ui mini form" id="formtest">
                        <div class="field inline">
                            <span style="float: left">
                            <i class="user icon"></i>
                            <label class="required">Name</label>
                                </span>

                            <div class="ui customerList search">
                                <div class="ui icon input" style="width:75%;">
                                    <input autocomplete="off" type="text" class="prompt" id="customerName"
                                           name="customerName"
                                           placeholder="customer Name">

                                </div>
                                <div class="results"></div>
                            </div>
                        </div>

                        <div class="field inline">
                            <span style="float: left">
                            <i class="mobile icon"></i>

                            <label>Phone</label>
                            </span>
                            <input class="cwide" type="text" id="phone" name="phone" placeholder="Phone Number">
                        </div>
                        <div class="field inline">
                            <span style="float: left">
                            <i class="registered icon"></i>
                            <label>GST Reg</label>
                            </span>
                            <input class="cwide" type="text" name="gst" id="gst" placeholder="GST Reg"
                            >
                        </div>
                        <div class="field inline">
                            <span style="float: left">
                            <i class="mail icon"></i>

                            <label>Email</label>
                            </span>
                            <input class="cwide" type="text" id="email" name="email" placeholder="Email">
                            <input type="hidden" name="customerID" id="customerID" value="NaN">

                        </div>
                    </form>
                </div>

                <div class="sixteen wide tablet four wide computer column" style="margin-top: 2px">
                    <form class="ui tiny form" id="formtest2">
                        <div class="field inline">
                            <span style="float: left">
                            <i class="map marker alternate icon"></i>
                            <label>Address</label>
                                </span>
{#                            <textarea class="cwide" rows="1" id="address"></textarea>#}
                             <input class="cwide" type="text" name="address" id="address" placeholder="Address"
                            >
                        </div>
                        <div class="field inline">
                            <span style="float: left">
                            <i class="street view icon"></i>
                            <label>State</label>
                            </span>
                            <select class="ui cwide  dropdown" id="state">
                                <option value="" hidden selected>State</option>
                                <option value="Andhra Pradesh">Andhra Pradesh</option>
                                <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                <option value="Assam" selected>Assam</option>
                                <option value="Bihar">Bihar</option>
                                <option value="Chhattisgarh">Chhattisgarh</option>
                                <option value="Goa">Goa</option>
                                <option value="Gujarat">Gujarat</option>
                                <option value="Haryana">Haryana</option>
                                <option value="Himachal Pradesh">Himachal Pradesh</option>
                                <option value="Jammu & Kashmir">Jammu & Kashmir</option>
                                <option value="Jarkhand">Jarkhand</option>
                                <option value="Karnataka">Karnataka</option>
                                <option value="Kerala">Kerala</option>
                                <option value="Madhya Pradesh">Madhya Pradesh</option>
                                <option value="Maharastra">Maharastra</option>
                                <option value="Manipur">Manipur</option>
                                <option value="Meghalaya">Meghalaya</option>
                                <option value="Mizoram">Mizoram</option>
                                <option value="Nagaland">Nagaland</option>
                                <option value="Orissa">Orissa</option>
                                <option value="Punjab">Punjab</option>
                                <option value="Rajasthan">Rajasthan</option>
                                <option value="Sikkim">Sikkim</option>
                                <option value="Tamil Nadu">Tamil Nadu</option>
                                <option value="Telangana">Telangana</option>
                                <option value="Tripura">Tripura</option>
                                <option value="Utter Pradesh">Utter Pradesh</option>
                                <option value="Uttarakhand">Uttarakhand</option>
                                <option value="West Bengal">West Bengal</option>
                            </select>
                        </div>
                        <div class="field inline">
                            <span style="float: left">
                            <i class="building icon"></i>
                            <label>Company</label>
                            </span>
                            <select style="    background-color: bisque;" class="ui cwide dropdown" id="company"
                                    onchange="changeCompany()">
                                {% for foo in company %}
                                    <option value="{{ foo.pk }}">{{ foo.name }}</option>
                                {% endfor %}


                            </select>
                        </div>


                        <div class="field inline">
                            <span style="float: left">
                            <i class="cart arrow down icon"></i>
                            <label>Type</label>
                            </span>
                            <select style="    background-color: bisque;" class="ui cwide dropdown" id="pType"
                                    onchange="changeProductType()">
                                {% if  request.user|has_group:"Admin" %}
                                    <option value="Jet" selected>Jet</option>
                                {% endif %}

                                <option value="Normal">Normal</option>


                            </select>
                        </div>
                    </form>
                </div>

                <div class="sixteen wide tablet six wide computer column">
                    <div class="ui form">
                        <div class="ui tiny form">
                            <div class="inline fields" style="margin-top: 5px;">
                                <i class="amazon pay icon"></i>
                                <label>Payment Type</label>
                                <div class="field">
                                    <div class="ui radio checkbox checked" onclick="showDay('n')">
                                        <input type="radio" name="payment" checked="" value="Cash" tabindex="0"
                                               class="hidden">
                                        <label>Cash Bill</label>
                                    </div>
                                </div>
                                <div class="field">
                                    <div class="ui radio checkbox" onclick="showDay('n')">
                                        <input type="radio" name="payment" value="Card" tabindex="0" class="hidden">
                                        <label>Card</label>
                                    </div>
                                </div>
                                <div class="field">
                                    <div class="ui radio checkbox" onclick="showDay('y')">
                                        <input type="radio" name="payment" value="Credit" tabindex="0" class="hidden">
                                        <label>Credit</label>
                                    </div>
                                </div>
                                <div class="field">
                                    <div class="ui radio checkbox" onclick="showDay('c')">
                                        <input type="radio" name="payment" value="Cheque" tabindex="0" class="hidden">
                                        <label>Cheque</label>
                                    </div>
                                </div>


                            </div>
                            <div class="field inline" id="days" style=" display: none; margin-bottom: 0.5em;">
                            <span style="float: left">
                            <i class="calendar check icon"></i>
                            <label>Days</label>
                                </span>
                                <input style="width: 78%" type="text" name="cDays" id="cDays"
                                       placeholder="Credit Days">
                            </div>
                            <div class="field inline" id="cheque" style="padding-bottom: 5px; display: none;">
                            <span style="float: left">
                            <i class="receipt icon"></i>
                            <label>Cheque Detail</label>
                                </span>
                                <input style="width: 77%" type="text" name="chequeDetail"
                                       placeholder="Cheque Detail" id="chequeDetail">
                            </div>

                        </div>
                        <form class="ui tiny form" id="formtest3">

                            <div class="ui doubling two column grid">
                                <div class="ten column" >
                                    <div class="field inline">
                            <span style="float: left">
                            <i class="scroll icon"></i>
                            <label>Invoice No</label>
                                </span>

                                        <div class="ui left labeled  input" style="width: 65%; ">
                                            <div class="ui dropdown teal label" id="invoiceSeriesChoose">
                                                <div class="text" id="defaultInvoiceSeries">N/A</div>
                                                <i class="dropdown icon"></i>
                                                <input type="hidden" id="invoiceSeriesID" value="N/A">
                                                <div class="menu" id="otherInvoiceSeries">

                                                </div>
                                            </div>
                                            <input type="text" placeholder="Invoice Number" id="invoiceNo"
                                                   name="nainvoiceme" style="width: 17%" readonly>

                                        </div>


                                    </div>
                                </div>
                                <div class=" six column" >
                                    <div class="field inline" id="standard_calendar">
                            <span style="float: left">
                            <i class="calendar alternate icon"></i>
                            <label>Date</label>
                            </span>
                                        <input style="width: 70%" type="text" name="gst" placeholder="Date"
                                               autocomplete="off"
                                               id="date">
                                    </div>
                                </div>


                            </div>

                            <div class="field inline" style="padding-top: 5px;">
                            <span style="float: left">
                            <i class="receipt icon"></i>
                            <label>Challan No.</label>
                                </span>
                                <input type="text" name="challNo" style="width: 75%"
                                       placeholder="Challan Number" id="challNo">


                            </div>


                        </form>

                    </div>
                </div>

                <div class="sixteen wide tablet two wide computer column">
                    <a href="">
                        <i class="scroll icon" style="font-size: 3rem; padding: 40px;margin-right: 50px;"></i>
                        <p>Create New Invoice</p>
                    </a>


                </div>
            </div>
        </div>

        <div class="ui horizontal divider">
        </div>
        <div class="ui internally celled grid">
            <div class="row" style="padding-bottom: 0!important;padding-top: 0!important;">

                <div class="sixteen wide tablet eleven wide computer column left aligned" style="padding-top: 0!important;padding-bottom: 0;padding-left: 0;padding-right: 0">
                    <div class="ui mini form">
                        <div class="seven fields">
                            <div class="field">
                                <label  >Product Name <i onclick="openProduct()"
                                                                                  class="plus green icon"
                                                                                  style="cursor:pointer"></i></label>
                                <div class="ui productList search">
                                    <div class="ui icon input">
                                        <input type="text" class="prompt" id="productName" name="productName"
                                               placeholder="Product Name" onfocus="proSearch()">
                                        <i class="shopping bag icon"></i>
                                        <input type="hidden" id="itemID">


                                    </div>
                                    <div class="results"></div>
                                </div>
                            </div>
                            <div class="field">
                                <label  >Quantity</label>
                                <input placeholder="Quantity" type="text"
                                       id="quantity">
                            </div>
                            <div class="field">
                                <label  >Unit</label>
                                <input placeholder="Unit" type="text"
                                       id="unit" readonly style="background-color: lightgray;">
                            </div>
                            <div class="field">
                                <label  >Net Price(₹)</label>
                                <input placeholder="Net Price" type="number" id="netPrice">
                            </div>

                            <div class="field">
                                <label  >GST</label>
                                <input placeholder="GST" type="number" id="GST">
                            </div>
                            <div class="field">
                                <label  >Rate(₹) <span class="ui red text" id="lsp"
                                                                                data-tooltip="Last selling price of the product to a customer"
                                                                                data-position="top center"></span></label>
                                <input placeholder="Price" type="number" id="Price">
                            </div>

                            <div class="field">
                                <label  >Total (Without Tax)(₹)</label>
                                <input placeholder="Total" type="number" id="total">
                            </div>
                        </div>

                        <div class="eight fields">
                            <div class="field">
                                <label  >Description</label>
                                <input placeholder="Description" type="text" id="description">
                            </div>
                            <div class="field" style="width: 10%">
                                <label  >Bar Code</label>
                                <input placeholder="Bar Code" type="text" id="barCode">
                            </div>

                            <div class="field">
                                <label  >Category <i onclick="openCategory()"
                                                                              class="plus green icon"
                                                                              style="cursor:pointer"></i></label>
                                <input placeholder="Category" type="text" id="category" readonly
                                       style="background-color: lightgray;">
                            </div>
                            <div class="field" style="width:10%;">
                                <label  >HSN</label>
                                <input placeholder="HSN" type="text" id="hsn" readonly
                                       style="background-color: lightgray;">
                            </div>
                            <div class="field" style="width:10%;">
                                <label  >Stock</label>
                                <input placeholder="Stock" type="number" id="stock" readonly
                                       style="background-color: lightgray;">
                            </div>
                            <div class="field" style="width:10%;">
                                <label  >MRP(₹)</label>
                                <input placeholder="MRP" type="number" id="mrp" readonly
                                       style="background-color: lightgray;">
                            </div>
                            <div class="field" style="width:10%;">
                                <label  >Item Dics%</label>
                                <input placeholder="Item Disc%"  type="number" id="disc" value="0">
                            </div>
                            <div class="field" style="    padding-top: 1.3rem;">
                                <div class="ui buttons">
                                    <button class="ui mini positive button" id="addItemBtn" type="button"
                                            onclick="addSubItems()"><i class="plus icon"></i>Add
                                    </button>
                                    <button style="display: none" type="button" id="updateItemBtn"
                                            onclick="updateSubItems()" class="ui mini orange button">
                                        <i class="icon redo"></i>
                                        Update
                                    </button>
                                    <div class="or"></div>
                                    <button class="ui mini button red" type="button" onclick="ClearData()"><i
                                            class="minus icon"></i>
                                        Clear
                                    </button>


                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="overflow-x: scroll">
                    <table class="ui unstackable  sortable celled very nowrap very small compact table " id="itemTable" style="font-size: 0.8em">
                        <thead>
                        <tr>
                            <th>Sl No.</th>
                            <th>Product</th>
                            <th>Description</th>
                            <th>Category</th>
                            <th>HSN</th>
                            <th>Qty</th>
                            <th>Unit</th>
                            <th>Rate(₹)</th>
                            <th>GST %</th>
                            <th>Item Disc %</th>
                            <th>Net Rate(₹)</th>
                            <th>Total(₹)</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
</div>
                </div>

                <div class="sixteen wide tablet five wide computer column">
                    <div class="row">
                    <div class="ui grid">
                        <div class="sixteen wide tablet eight wide computer column" style="padding: 0;min-height: 100px;">
                            <div class="ui vertical menu"
                                 style="width: 100%;float: right;position: absolute;text-align: left;">
                                <a class="teal item">
                                    Sub Total :
                                    <div class="ui teal left pointing label" id="subTotal">0.00</div>
                                </a>
                                <a class="item" style="display: none">
                                    Disc % :
                                    <div class="ui violet label" id="billDiscount" contentEditable="true">0.00</div>
                                </a>
                                <a class="item" id="taxDiv">
                                    Taxable :
                                    <div class="ui teal left pointing label" id="taxable">0.00</div>
                                </a>
                            </div>

                        </div>
                             <div class="sixteen wide tablet eight wide computer column" style="padding:0;min-height: 130px;">
                            <div class="ui vertical menu"
                                 style="width: 99%;float: right;position: absolute;text-align: left;">
                                <a class="teal item" id="gstDiv">
                                    GST :
                                    <div class="ui teal left pointing label" id="taxableGST">0.00</div>
                                </a>
                                <a class="item ">
                                    Total :
                                    <div class="ui teal left pointing label" id="totalAfterGst">0.00</div>
                                </a>
                                <a class="item">
                                    Round Off :
                                    <div class="ui teal left pointing label" id="roundOff">0.00</div>
                                </a>
                            </div>

                        </div>
 <div class="row" style="padding-bottom: 0!important;padding-top: 0!important;">

                <div class="sixteen wide tablet sixteen wide computer column" style="text-align: center;padding:0;">
                    <button class="ui mini primary button" onclick="AddExtraDetail()">
                        Add Extra Details
                    </button>
                    <div class="ui vertical menu" style="width: 100%;float: right;text-align: left;margin-bottom: 0;
    margin-top: 0.5em;">
                        <a class="teal item ">
                            <strong style="color: black;">Other Charges (₹) :</strong>
                            <div class="ui violet label" id="otherCharges" contentEditable="true">0.00</div>
                        </a>
                        <a class="teal item ">
                            <strong style="color: black;">Personal Discount (₹) :</strong>
                            <div class="ui violet label" id="personalDiscount" contentEditable="true">0.00</div>
                        </a><a class="teal item active">
                        <strong style="color: black;">Grand Total (₹) :</strong>
                        <div class="ui blue label" id="GrandTotal">0.00</div>
                    </a>
                        <div class="ui mini form">
                            <div class="three fields">
                                <div class="field">
                                    <label>Paid Against Bill</label>
                                    <input placeholder="Paid Against Bill" type="number" id="paidAgainstBill" value="0">
                                </div>

                                <div class="field" >
                                    <label>Paid</label>
                                    <input placeholder="Paid" type="number" id="paidMoney" value="0">
                                </div>
                                <div class="field">
                                    <label id="returnLabel">Due/Return</label>
                                    <input placeholder="Due/Return" type="number" id="dueOrReturn" value="0">
                                </div>


                            </div>
                        </div>
                    </div>

                    <div class="ui center aligned basic "
                         style="margin-top: 200px;padding-top: 0;padding-bottom: 0;">


                        <div class="ui " style="padding-bottom: 0">
                            <div class="ui two column very relaxed grid" style="padding-bottom: 0;">
                                <div class="column">
                                    <a onclick="salesSave()" style="cursor: pointer;">
                                        <i class="save icon" style="font-size: 2rem"></i>
                                        <p>Sale Now</p>
                                    </a>
                                </div>
                                <div class="column">
                                    <a onclick="saleLater()" style="cursor: pointer;">
                                        <i class="box icon" style="font-size: 2rem"></i>
                                        <p>Sale Later</p>
                                    </a>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

                    </div>
</div>

                </div>
            </div>
        </div>
     <div class="ui internally  grid">

            </div>
    </div>

    <div class="ui basic modal custom" id="delItemModal">
        <div class="ui icon header">
            <i class="archive icon"></i>
            Item will be Deleted.
        </div>
        <div class="content">
            <p style="text-align: center" >The Item detail will be deleted, are you sure to delete
                this Item?</p>
        </div>
        <div class="actions">
            <div class="ui red basic cancel inverted button">
                <i class="remove icon"></i>
                No
            </div>
            <input type="hidden" id="itemDelID">
            <div class="ui green ok inverted button" onclick="deleteItem()">
                <i class="checkmark icon"></i>
                Yes
            </div>
        </div>
    </div>



    <div class="ui modal" id="ExtraDetails">
        <i class="close icon"></i>
        <div class="header">
            Add Extra Details
        </div>
        <div class="image content">
            <div class="description">
                <form class="ui form" id="AddCompanyForm">{% csrf_token %}

                    <div class="two fields">
                        <div class="field">
                            <label>Delivery Note</label>
                            <input type="text" name="deliveryNote" id="deliveryNote" placeholder="deliveryNote">
                        </div>
                        <div class="field">
                            <label>Supplier Reference</label>
                            <input type="text" name="supplierReference" id="supplierReference"
                                   placeholder="Supplier Reference">
                        </div>
                    </div>

                    <div class="two fields">
                        <div class="field">
                            <label>Buyer's Order Number</label>
                            <input type="text" name="orderNumber" placeholder="Buyer's Order Number"
                                   id="orderNumber">
                        </div>
                        <div class="field">
                            <label>Dispatch Document Number</label>
                            <input type="text" name="dispatchNumber" placeholder="Dispatch Document Number"
                                   id="dispatchNumber">
                        </div>
                    </div>


                    <div class="two fields">
                        <div class="field">
                            <label>Dispatch Through</label>
                            <input type="text" name="dispatchThrough" placeholder="Dispatch Through"
                                   id="dispatchThrough">
                        </div>
                        <div class="field">
                            <label>Other Reference</label>
                            <input type="text" name="otherReference" placeholder="Other Reference" id="otherReference">
                        </div>
                    </div>
                    <div class="two fields">
                        <div class="field" id="calender2">
                            <label>Dispatch Note Date</label>
                            <input type="text" name="dispatchNoteDate" placeholder="Dispatch Note Date"
                                   id="dispatchNoteDate">
                        </div>
                        <div class="field">
                            <label>Destination</label>
                            <input type="text" name="destination" placeholder="Destination" id="destination">
                        </div>
                    </div>


                </form>
            </div>
        </div>
        <div class="actions">
            <div class="ui black deny button">
                Close
            </div>
            <div class="ui positive right labeled icon button">
                Done adding
                <i class="checkmark icon"></i>
            </div>
        </div>
    </div>


    <i onclick="getProductStock()" class=" blink_me circular pink custom button shopping bag icon"
       style="top:50px;position: fixed;right: 10px;cursor: pointer;z-index: 100"></i>

    <div class="ui custom popup top left transition hidden" style="height: 450px;overflow-y: scroll">
        <h2 class="ui header">
            <i class="shopping bag icon"></i>
            <div class="content">
                Products running out of stocks
            </div>
        </h2>
        <div class="ui divided items" id="runningStock">
            <div class="item">
                <div class="content">
                    <h5 class="ui sub header">Product name<span class="meta cinema"> (Brand) </span></h5>
                    <div class="meta">
                        <span class="cinema">Stock Available: <div class="ui label">IMAX</div></span>
                    </div>
                </div>
            </div>


        </div>
    </div>


    <div class="ui modal small " id="PrintOption">
        <i class="close icon" onclick="reloadWindow()"></i>
        <div class="header">
            Select Printing Option
            <input type="hidden" id="printSaleID">
        </div>
        <div class="image content">
            <div class="description">
                <div class="ui center aligned basic segment">


                    <div class="ui segment">
                        <div class="ui three column very relaxed grid">

                            <div class="column nSale" style="padding-left: 0;padding-right: 0">
                                <a onclick="printInvoiceA4()" style="cursor: pointer;">
                                    <i class="print icon" style="font-size: 2rem"></i>
                                    <p>Print Invoice A4</p>
                                </a>
                            </div>

                            <div class="column jSale" style="padding-left: 0;padding-right: 0">
                                <a onclick="printBillA4()" style="cursor: pointer;">
                                    <i class="print icon" style="font-size: 2rem"></i>
                                    <p>Print Bill A4</p>
                                </a>
                            </div>
                            </span>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div class="actions">
            <div class="ui black deny button" onclick="reloadWindow()">
                Close
            </div>
        </div>
    </div>


{% endblock %}

{% block js %}
    <script>


        {#$('.menu .item').tab();#}
        $('.ui.radio.checkbox').checkbox();
        var today = new Date();
        $('#standard_calendar')
            .calendar({
                    initialDate: today.getDate() + '/' + (today.getMonth() + 1) + '/' + today.getFullYear(),
                    monthFirst: false,
                    type: 'date',
                    formatter: {
                        date: function (date, settings) {

                            if (!date) return '';
                            var day = String(date.getDate());
                            var month = String(date.getMonth() + 1);
                            var year = date.getFullYear();
                            return day + '/' + month + '/' + year;
                        }
                    }
                }
            );


        $('#calender2')
            .calendar({
                    initialDate: today.getDate() + '/' + (today.getMonth() + 1) + '/' + today.getFullYear(),
                    monthFirst: false,
                    type: 'date',
                    formatter: {
                        date: function (date, settings) {
                            if (!date) return '';
                            var day = date.getDate();
                            var month = date.getMonth() + 1;
                            var year = date.getFullYear();
                            return day + '/' + month + '/' + year;
                        }
                    },
                    popupOptions: {
                        observeChanges: false
                    }

                }
            );

        var pType;
        pType = $('#pType').val();
        $(changeProductType())
        function changeProductType() {
            pType = $('#pType').val();
            $('#itemTable tbody tr').remove();
            var subTotal = $('#subTotal').html('0.00');
            var taxable = $('#taxable').html('0.00');
            var totalFinal = $('#totalAfterGst').html('0.00');
            var roundOff = $('#roundOff').html('0.00');
            var taxableGST = $('#taxableGST').html('0.00');
            var bill_disc = $('#billDiscount').html('0.00');

            var GrandTotal = $('#GrandTotal').html('0.00');
            ClearData();

            if (pType === 'Jet') {
                $('#productForm').trigger('reset');
                proSearch();

                $('#invoiceNo').val('N/A').attr('readonly', true).css('background-color', 'lightgray');
                $('#GST').val('0').attr('readonly', true).css('background-color', 'lightgray');
                $('#taxDiv').attr('readonly', true).css('background-color', 'lightgray');
                $('#gstDiv').attr('readonly', true).css('background-color', 'lightgray');
                $('#defaultInvoiceSeries').html('N/A');
                $('#invoiceSeriesID').val('N/A');

            }
            else {
                $('#productForm').trigger('reset');
                proSearch()
                $('#invoiceNo').val('').attr('readonly', true).css('background-color', 'white');
                $('#GST').val('0').attr('readonly', true).css('background-color', 'lightgray');
                $('#taxDiv').attr('readonly', false).css('background-color', 'white');
                $('#gstDiv').attr('readonly', false).css('background-color', 'white');

                getInvoiceSeries();

            }
        }


        function changeCompany() {
            pType = $('#pType').val();
            $('#itemTable tbody tr').remove();
            var subTotal = $('#subTotal').html('0.00');
            var taxable = $('#taxable').html('0.00');
            var totalFinal = $('#totalAfterGst').html('0.00');
            var roundOff = $('#roundOff').html('0.00');
            var taxableGST = $('#taxableGST').html('0.00');
            var bill_disc = $('#billDiscount').html('0.00');

            var GrandTotal = $('#GrandTotal').html('0.00');


            $('#productForm').trigger('reset');
            proSearch()
            $('#invoiceNo').val('').attr('readonly', true).css('background-color', 'white');
            $('#GST').val('').attr('readonly', false).css('background-color', 'white');
            $('#taxDiv').attr('readonly', false).css('background-color', 'white');
            $('#gstDiv').attr('readonly', false).css('background-color', 'white');
            changeProductType();
            getInvoiceSeries();
        }

        $('.ui.customerList')
            .search({
                apiSettings: {
                    url: '/api/GetCustomerList/?q={query}'
                },
                fields: {
                    results: 'data',
                    title: 'Name',
                    "price": "Gst",
                    "description": "Address",
                },
                onSelect: function (result) {

                    $('#customerID').val(result.ID);
                    getCustomerDetail();


                },
                cache: false,
                minCharacters: 1
            });

        function getCustomerDetail() {
            var customerID = $('#customerID').val();
            $.ajax({
                type: 'get',
                url: '/api/GetCustomerDetailByName/?q=' + customerID,

                success: function (response) {
                    $('#sID').val(response.data['ID']);
                    $('#gst').val(response.data['Gst']);
                    $('#phone').val(response.data['Phone']);
                    $('#email').val(response.data['Email']);
                    $('#address').val(response.data['Address']);
                    $('#state').val(response.data['State']);
                    $('#customerName').val(response.data['Name']);


                },

                error: function () {
                    $('body')
                        .toast({
                            class: 'error',
                            message: 'An error occurred !'
                        })
                    ;
                }
            });
        }

        function proSearch() {
            p = $('#pType').val();
            company = $('#company').val();
            $('.ui.productList').search({

                apiSettings: {
                    url: '/api/GetProductList/?q={query}&type=' + p + '&company=' + company
                },
                fields: {
                    results: 'data',
                    title: 'ProductName',
                    "price": "Brand",
                    "description": "Company",
                },
                minCharacters: 1,
                onSelect: function (result) {
                    ClearData();
                    $('#itemID').val(result.ID);
                    getProductLSP();
                    getProductDetailByName();


                },
                cache: false,
            });
        }

        function getProductDetailByName() {
            var name = $('#itemID').val();
            var pType = $('#pType').val();


            $.ajax({
                type: 'get',
                url: '/api/GetProductDetailByName/?q=' + name + '&pType=' + pType,

                success: function (response) {
                    if (pType === 'Jet') {

                        $('#itemID').val(response.data['ID']);
                        $('#productName').val(response.data['ProductName']);

                        $('#category').val(response.data['Category']);
                        {#                        $('#Price').val(response.data['Price']);#}
                        $('#GST').val('0');
                        $('#hsn').val(response.data['Hsn']);
                        $('#mrp').val(response.data['Mrp']);
                        $('#stock').val(response.data['Stock']);
                        $('#unit').val(response.data['ActualUnit']);
                        $('#netPrice').val(response.data['Net']);
                        $('#Price').val(response.data['Net']);
                    }
                    else {
                        $('#itemID').val(response.data['ID']);
                        $('#productName').val(response.data['ProductName']);

                        $('#category').val(response.data['Category']);
                        {#                        $('#Price').val(response.data['Price']);#}
                        $('#GST').val(response.data['Gst']);
                        $('#hsn').val(response.data['Hsn']);
                        $('#mrp').val(response.data['Mrp']);
                        $('#stock').val(response.data['Stock']);
                        $('#unit').val(response.data['ActualUnit']);
                        $('#netPrice').val(response.data['Net']);
                        $('#Price').val(response.data['Sp']);

                    }

                },

                error: function () {
                    $('body')
                        .toast({
                            class: 'error',
                            message: 'An error occurred !'
                        })
                    ;
                }
            });
        }

        function showDay(p) {
            if (p === 'n') {
                $('#days').css('display', 'none')
                $('#cheque').css('display', 'none')
            }
            else if (p === 'y') {
                $('#days').css('display', '')
                $('#cheque').css('display', 'none')
            } else {
                $('#days').css('display', 'none')
                $('#cheque').css('display', '')

            }

        }

        $("#quantity").keyup(function () {
            var q = $('#quantity').val();
            var price = $('#Price').val();
            {#            var gst = $('#GST').val();#}
            var disc = $('#disc').val();

            {#            var netPriceCal = (parseFloat(price) * parseFloat(gst) / 100.0) + parseFloat(price);#}
            var totalPriceCal = (parseFloat(price) * parseFloat(q)) - (parseFloat(price) * parseFloat(q)) * (parseFloat(disc) / 100.0);
            {#            $('#netPrice').val(netPriceCal);#}
            $('#total').val(totalPriceCal);


        });


        $('#netPrice').keyup(function () {
            var q = $('#quantity').val();
            var gst = $('#GST').val();
            var disc = $('#disc').val();
            var net = $('#netPrice').val();
            var sp = parseFloat(net) / (1 + ((parseFloat(gst) / 100)));
            $('#Price').val(sp.toFixed(2));

            var totalPriceCal = (parseFloat(sp) * parseFloat(q)) - (parseFloat(sp) * parseFloat(q)) * (parseFloat(disc) / 100.0);
            $('#total').val(totalPriceCal.toFixed(2));


        });


        $("#Price").keyup(function () {
            var q = $('#quantity').val();
            var price = $('#Price').val();
            var gst = $('#GST').val();
            var disc = $('#disc').val();

            var totalPriceCal = (parseFloat(price) * parseFloat(q)) - (parseFloat(price) * parseFloat(q)) * (parseFloat(disc) / 100.0);
            var totalPriceOfAnItem = parseFloat(totalPriceCal) / parseFloat(q);
            var netPriceCal = (parseFloat(totalPriceOfAnItem) * parseFloat(gst) / 100) + parseFloat(totalPriceOfAnItem);
            $('#netPrice').val(netPriceCal.toFixed(2));
            $('#total').val(totalPriceCal.toFixed(2));


        });

        $("#disc").keyup(function () {
            var q = $('#quantity').val();
            var price = $('#Price').val();
            var gst = $('#GST').val();
            var disc = $('#disc').val();

            var totalPriceCal = (parseFloat(price) * parseFloat(q)) - (parseFloat(price) * parseFloat(q)) * (parseFloat(disc) / 100.0);
            var totalPriceOfAnItem = parseFloat(totalPriceCal) / parseFloat(q);
            var netPriceCal = (parseFloat(totalPriceOfAnItem) * parseFloat(gst) / 100) + parseFloat(totalPriceOfAnItem);

            $('#netPrice').val(netPriceCal.toFixed(2));
            $('#total').val(totalPriceCal.toFixed(2));


        });

        $("#otherCharges").keyup(function () {
            calTaxAndTotal();
            returnCalc();


        });

        $("#personalDiscount").keyup(function () {
            calTaxAndTotal();
            returnCalc();


        });

        function returnCalc() {
            var GrandTotal = $('#GrandTotal').html();
            var paidMoney = $('#paidMoney').val();
            var dueOrReturn = parseFloat(paidMoney) - parseFloat(GrandTotal);
            $('#dueOrReturn').val(dueOrReturn)

            if (dueOrReturn < 0) {
                $('#returnLabel').html('Due')

            }
            else {
                $('#returnLabel').html('Return')
            }

        }

        $("#paidAgainstBill").keyup(function () {

            var paidAgainstBill = $('#paidAgainstBill').val();
            var paidMoney = $('#paidMoney').val(paidAgainstBill);

            returnCalc();


        });
        $("#paidMoney").keyup(function () {
            returnCalc();


        });

        $("#billDiscount").keyup(function () {
            calTaxAndTotal();
            returnCalc();
        });

        $("#customerName").keyup(function () {
            var charName = $('#customerName').val();
            if (charName.length === 0) {
                $('#formtest').trigger('reset');
                $('#formtest2').trigger('reset');
                $('#customerID').val('NaN');
            }


        });

        function addSubItems() {
            var itemID = $('#itemID').val();
            var productName = $('#productName').val();
            var Quantity = $('#quantity').val();
            var Unit = $('#unit').val();
            var Price = $('#Price').val();
            var GST = $('#GST').val();
            var disc = $('#disc').val();
            var NetPrice = $('#netPrice').val();
            var Total = $('#total').val();
            var barCode = $('#barCode').val();
            var category = $('#category').val();
            var hsn = $('#hsn').val();
            var stock = $('#stock').val();
            var mrp = $('#mrp').val();
            var description = $('#description').val();
            if (productName === '' || Quantity === '' || Price === '' ||
                Total === '' || category === '') {
                $('body')
                    .toast({
                        class: 'orange',
                        message: 'Product Name, Category, Quantity and Total are required !'
                    })
                ;
            }
            else {
                $('#' + itemID).remove();
                $('#itemTable tbody').append('<tr id ="' + itemID + '" ><td id ="row' + itemID + '">#</td> <td id ="product' + itemID + '">' + productName + '</td><td id ="description' + itemID + '">' + description + '</td><td id ="category' + itemID + '">' + category + '</td><td id ="hsn' + itemID + '">' + hsn + '</td><td id ="quantity' + itemID + '">' + Quantity + '</td><td id ="unit' + itemID + '">' + Unit + '</td><td id ="price' + itemID + '">' + Price + '</td><td id ="gst' + itemID + '">' + GST + '</td><td id ="disc' + itemID + '">' + disc + '</td><td id ="netprice' + itemID + '">' + NetPrice + '</td><td id ="total' + itemID + '">' + Total + '</td><td><button style="font-size:10px;" onclick="GetItemDetail(' + itemID + ')" class="ui circular facebook icon button green"><i class="pen icon"></i></button><button style="font-size:10px;" onclick="delItem(' + itemID + ')" class="ui circular youtube icon button"><i class="trash alternate icon"></i></button></td></tr>');
                ClearData();
                calTaxAndTotal();
                returnCalc();
                $('#lsp').html();
            }

        }


        function GetItemDetail(id) {
            $('#addItemBtn').css('display', 'none');
            $('#updateItemBtn').css('display', '');
            var product = $('#product' + id).html();
            var description = $('#description' + id).html();
            var category = $('#category' + id).html();
            var hsn = $('#hsn' + id).html();
            var quantity = $('#quantity' + id).html();
            var unit = $('#unit' + id).html();
            var price = $('#price' + id).html();
            var gst = $('#gst' + id).html();
            var disc = $('#disc' + id).html();
            var netprice = $('#netprice' + id).html();
            var total = $('#total' + id).html();
            $('#productName').val(product);
            $('#quantity').val(quantity);
            $('#unit').val(unit);
            $('#Price').val(price);
            $('#GST').val(gst);
            $('#netPrice').val(netprice);
            $('#total').val(total);
            $('#category').val(category);
            $('#hsn').val(hsn);
            $('#disc').val(disc);
            $('#itemID').val(id);
            $('#description').val(description);
            var pType = $('#pType').val();

            $.ajax({
                type: 'get',
                url: '/api/GetProductDetailByName/?q=' + product + '&pType=' + pType,

                success: function (response) {
                    $('#mrp').val(response.data['Mrp']);
                    $('#stock').val(response.data['Stock']);
                },

                error: function () {
                    $('body')
                        .toast({
                            class: 'error',
                            message: 'An error occurred !'
                        })
                    ;
                }
            });
        }


        function updateSubItems() {
            var id = $('#itemID').val();
            var productName = $('#productName').val();
            var Quantity = $('#quantity').val();
            var Unit = $('#unit').val();
            var Price = $('#Price').val();
            var GST = $('#GST').val();
            var NetPrice = $('#netPrice').val();
            var Total = $('#total').val();
            var barCode = $('#barCode').val();
            var category = $('#category').val();
            var hsn = $('#hsn').val();
            var stock = $('#stock').val();
            var mrp = $('#mrp').val();
            var disc = $('#disc').val();
            var description = $('#description').val();
            if (productName === '' || Quantity === '' || Price === '' ||
                Total === '' || category === '') {
                $('body')
                    .toast({
                        class: 'orange',
                        message: 'Product Name, Category, Quantity and Total are required !'
                    })
                ;
            }
            else {
                $('#product' + id).html(productName);
                $('#category' + id).html(category);
                $('#hsn' + id).html(hsn);
                $('#quantity' + id).html(Quantity);
                $('#unit' + id).html(Unit);
                $('#price' + id).html(Price);
                $('#gst' + id).html(GST);
                $('#netprice' + id).html(NetPrice);
                $('#total' + id).html(Total);
                $('#disc' + id).html(disc);
                $('#description' + id).html(description);

                ClearData();
                calTaxAndTotal();
                returnCalc();
            }

        }

        function delItem(id) {
            $('#delItemModal')
                .modal('show')
            ;
            $('#itemDelID').val(id)
        }

        function deleteItem() {
            var id = $('#itemDelID').val();
            $('#' + id).remove();
            calTaxAndTotal();


        }
        function ClearData() {

            $('#addItemBtn').css('display', '');
            $('#updateItemBtn').css('display', 'none');

            $('#productName').val('');
            $('#quantity').val('');
            $('#unit').val('');
            $('#Price').val('');
            $('#GST').val('');
            $('#netPrice').val('');
            $('#total').val('');
            $('#barCode').val('');
            $('#category').val('');
            $('#hsn').val('');
            $('#stock').val('');
            $('#mrp').val('');
            $('#disc').val('0');
            $('#itemID').val('');
            $('#description').val('');
            $('#lsp').html('');
        }

        function calTaxAndTotal() {

            var subtotal = 0.0;
            var taxable = 0.0;
            var gstTotal = 0.0;
            var TotalAmount = 0.0;
            var roundOff = 0.0;
            var billDiscount = $('#billDiscount').html();
            var otherCharges = $('#otherCharges').html();
            var personalDiscount = $('#personalDiscount').html();

            $('#itemTable tbody tr').each(function () {

                var id = $(this).closest('tr').attr('id');
                var total = $('#total' + id).html();
                var gst = $('#gst' + id).html();
                var netprice = $('#netprice' + id).html();
                var price = $('#price' + id).html();
                var quantity = $('#quantity' + id).html();
                var disc = $('#disc' + id).html();

                var netP = (parseFloat(price) * parseFloat(quantity)) - (parseFloat(price) * parseFloat(quantity) * (parseFloat(disc / 100.0)));

                var gstT = (parseFloat(netP) * parseFloat(gst) / 100) * quantity;


                subtotal = subtotal + parseFloat(total);

                //taxable after discount
                var afterDiscount = (parseFloat(total) - (parseFloat(total) * (parseFloat(billDiscount) / 100)));
                taxable = taxable + parseFloat(afterDiscount);

                // gst after discount
                var gstPerItem = parseFloat(afterDiscount) * (parseFloat(gst) / 100);
                gstTotal = gstTotal + gstPerItem


            });

            $('#subTotal').html(subtotal.toFixed(2));
            $('#taxable').html(taxable.toFixed(2));

            $('#taxableGST').html(gstTotal.toFixed(2));
            var taxPlusGst = taxable + gstTotal;

            $('#totalAfterGst').html(taxPlusGst.toFixed(2));

            var roundNumber = Math.round(taxPlusGst.toFixed(2));

            var roundOfNumber = roundNumber - taxPlusGst.toFixed(2);
            $('#roundOff').html(roundOfNumber.toFixed(2))


            var grandTotal = parseFloat(taxPlusGst) + parseFloat(otherCharges) - parseFloat(personalDiscount) + parseFloat(roundOfNumber.toFixed(2));


            $('#GrandTotal').html(grandTotal.toFixed(2))

        }


        function AddExtraDetail() {

            $('#ExtraDetails')
                .modal('show')
            ;

        }

        //post
        function salesSave() {

            var challNo = $('#challNo').val();
            var personalDiscount = $('#personalDiscount').html();
            var customerID = $('#customerID').val();
            var name = $('#customerName').val();
            var gst = $('#gst').val();
            var phone = $('#phone').val();
            var email = $('#email').val();
            var address = $('#address').val();
            var state = $('#state').val();
            var pType = $('#pType').val();
            var payment = $('input[name="payment"]:checked').val();
            var cDays = $('#cDays').val();
            var invoiceNumber = $('#invoiceNo').val();
            var pDate = $('#date').val();
            var chequeDetail = $('#chequeDetail').val();
            var deliveryNote = $('#deliveryNote').val();
            var supplierReference = $('#supplierReference').val();
            var orderNumber = $('#orderNumber').val();
            var dispatchNumber = $('#dispatchNumber').val();
            var dispatchThrough = $('#dispatchThrough').val();
            var otherReference = $('#otherReference').val();
            var dispatchNoteDate = $('#dispatchNoteDate').val();
            var destination = $('#destination').val();
            var company = $('#company').val();
            var paid = $('#paidMoney').val();
            var dueOrReturn = $('#dueOrReturn').val();
            var invoiceSeriesID = $('#invoiceSeriesID').val();
            var defaultInvoiceSeries = $('#defaultInvoiceSeries').html();
            var paidAgainstBill = $('#paidAgainstBill').val();

            var datas = '';
            $('#itemTable tbody tr').each(function () {
                var id = $(this).closest('tr').attr('id');
                var pro = $('#product' + id).html();
                var cat = $('#category' + id).html();
                var hs = $('#hsn' + id).html();
                var qty = $('#quantity' + id).html();
                var pri = $('#price' + id).html();
                var gs = $('#gst' + id).html();
                var netp = $('#netprice' + id).html();
                var tot = $('#total' + id).html();
                var dis = $('#disc' + id).html();
                var unit = $('#unit' + id).html();
                var description = $('#description' + id).html();

                datas = datas + '' + id + '|' + pro + '|' + cat + '|' + hs + '|' + qty + '|' + pri + '|' + gs + '|' + netp + '|' + tot + '|' + dis + '|' + unit + '|' + description + '@'


            });

            var subTotal = $('#subTotal').html();
            var taxable = $('#taxable').html();
            var totalFinal = $('#totalAfterGst').html();
            var roundOff = $('#roundOff').html();
            var taxableGST = $('#taxableGST').html();
            var bill_disc = $('#billDiscount').html();
            var otherCharges = $('#otherCharges').html();

            var GrandTotal = $('#GrandTotal').html();
            if (name === '' || pDate === '' || subTotal === '' || taxable === '' || totalFinal === '' ||
                roundOff === '' || taxableGST === '' || bill_disc === '' || GrandTotal === '' || datas === '') {
                $('body')
                    .toast({
                        class: 'orange',
                        message: 'Customer Name, Date, Items, total are required !'
                    })
                ;
            } else {
                data = new FormData();
                data.append('challNo', challNo);
                data.append('customerID', customerID);
                data.append('name', name);
                data.append('gst', gst);
                data.append('phone', phone);
                data.append('email', email);
                data.append('address', address);
                data.append('state', state);
                data.append('pType', pType);
                data.append('payment', payment);
                data.append('cDays', cDays);
                data.append('invoiceNumber', invoiceNumber);
                data.append('pDate', pDate);
                data.append('datas', datas);
                data.append('subTotal', subTotal);
                data.append('taxable', taxable);
                data.append('totalFinal', totalFinal);
                data.append('roundOff', roundOff);
                data.append('taxableGST', taxableGST);
                data.append('bill_disc', bill_disc);
                data.append('GrandTotal', GrandTotal);
                data.append('otherCharges', otherCharges);
                data.append('chequeDetail', chequeDetail);
                data.append('deliveryNote', deliveryNote);
                data.append('supplierReference', supplierReference);
                data.append('orderNumber', orderNumber);
                data.append('dispatchNumber', dispatchNumber);
                data.append('dispatchThrough', dispatchThrough);
                data.append('otherReference', otherReference);
                data.append('dispatchNoteDate', dispatchNoteDate);
                data.append('destination', destination);
                data.append('company', company);
                data.append('paid', paid);
                data.append('dueOrReturn', dueOrReturn);
                data.append('invoiceSeriesID', invoiceSeriesID);
                data.append('defaultInvoiceSeries', defaultInvoiceSeries);
                data.append('paidAgainstBill', paidAgainstBill);
                data.append('personalDiscount', personalDiscount);


                $.ajax({
                    type: 'post',
                    url: '/api/AddNewSalesDetail/',
                    data: data,
                    contentType: false,
                    cache: false,
                    processData: false,


                    success: function (response) {
                        if (response.message === 'success') {
                            $('body')
                                .toast({
                                    class: 'success',
                                    message: 'New Sales created Successfully.'
                                });

                            $('#itemTable tbody tr').remove();
                            $('#formtest').trigger('reset');
                            $('#formtest2').trigger('reset');
                            $('#formtest3').trigger('reset');
                            $('#AddCompanyForm').trigger('reset');
                            $('#subTotal').html('0.00');
                            $('#taxable').html('0.00');
                            $('#totalAfterGst').html('0.00');
                            $('#roundOff').html('0.00');
                            $('#taxableGST').html('0.00');
                            $('#billDiscount').html('0.00');

                            $('#GrandTotal').html('0.00');
                            $('#otherCharges').html('0.00');
                            $('#personalDiscount').html('0.00');
                            $('#paidMoney').val('0');
                            $('#dueOrReturn').val('0');
                            $('#paidAgainstBill').val('0');
                            var today = new Date();
                            $('#standard_calendar')
                                .calendar({
                                        initialDate: today.getDate() + '/' + (today.getMonth() + 1) + '/' + today.getFullYear(),
                                        monthFirst: false,
                                        type: 'date',
                                        formatter: {
                                            date: function (date, settings) {

                                                if (!date) return '';
                                                var day = String(date.getDate());
                                                var month = String(date.getMonth() + 1);
                                                var year = date.getFullYear();
                                                return day + '/' + month + '/' + year;
                                            }
                                        }
                                    }
                                );
                            changeProductType();


                            PrintOption();
                            $('#printSaleID').val(response.saleID);
                            if (response.salesType === 'Jet') {
                                $('.nSale').css('display', 'none');
                                $('.jSale').css('display', '');

                            } else {
                                $('.nSale').css('display', '');
                                $('.jSale').css('display', 'none');
                            }


                        }
                        else {
                            $('body')
                                .toast({
                                    class: 'error',
                                    message: 'An error occurred !'
                                })
                            ;

                        }

                        return response;
                    },
                    error: function () {
                        $('body')
                            .toast({
                                class: 'error',
                                message: 'An error occurred !'
                            })
                        ;
                    }
                });


            }

        }

        $(getInvoiceSeries());
        function getInvoiceSeries() {
            var company = $('#company').val();
            pType = $('#pType').val();
            if (pType !== 'Jet') {
                $.ajax({
                    type: 'get',
                    url: '/api/get_invoice_series_by_company/?companyID=' + company,

                    success: function (response) {

                        $('#defaultInvoiceSeries').html('');
                        $('#defaultInvoiceSeries').html(response.data[0]["Series"]);
                        $('#invoiceSeriesID').val(response.data[0]["ID"]);
                        getInvoiceNumber(response.data[0]["ID"]);
                        $('#otherInvoiceSeries').html('');

                        var j;
                        for (j = 0; j < response.data.length; j++) {

                            $('#otherInvoiceSeries').append('<div class="item " onclick ="getInvoiceNumber(' + response.data[j]["ID"] + ')">' + response.data[j]["Series"] + '</div>');

                        }

                    },

                    error: function () {
                        $('body')
                            .toast({
                                class: 'error',
                                message: 'An error occurred !'
                            })
                        ;
                    }
                });
            }
            else {
                $('#defaultInvoiceSeries').html('N/A');
                $('#invoiceSeriesID').val('N/A');
            }

        }

        function getInvoiceNumber(id) {

            $.ajax({
                type: 'get',
                url: '/api/get_new_sale_invoice_number/?invoiceSeriesID=' + id,

                success: function (response) {

                    $('#invoiceNo').val(response.Invoice);
                    $('#invoiceSeriesID').val(id);

                },

                error: function () {
                    $('body')
                        .toast({
                            class: 'error',
                            message: 'An error occurred !'
                        })
                    ;
                }
            });
        }
        $('.custom.button')
            .popup({
                popup: $('.custom.popup'),
                on: 'click'
            })
        ;
        function getProductStock() {
            pType = $('#pType').val();
            var company = $('#company').val();

            $.ajax({
                type: 'get',
                url: '/api/get_running_down_out_of_stock_product_list/?pType=' + pType + '&companyID=' + company,

                success: function (response) {

                    $('#runningStock').html('');
                    if (response.data.length > 0) {
                        var j;
                        for (j = 0; j < response.data.length; j++) {

                            $('#runningStock').append('  <div class="item"><div class="content"><h5 class="ui sub header">' + response.data[j]["ProductName"] + '</h5> <div class="meta"> <span class="cinema">Stock Avialable: <div class="ui label">' + response.data[j]["Stock"] + '</div></span> </div> </div></div>');

                        }
                    }
                    else {
                        $('#runningStock').append('  <div class="sub header">Stock available .</div>')
                    }

                },

                error: function () {
                    $('body')
                        .toast({
                            class: 'error',
                            message: 'An error occurred !'
                        })
                    ;
                }
            });


        }
        function getProductLSP() {
            var customerID = $('#customerID').val();
            var itemID = $('#itemID').val();

            $.ajax({
                type: 'get',
                url: '/api/get_last_selling_price_of_the_product_by_customer/?pID=' + itemID + '&cID=' + customerID,

                success: function (response) {

                    $('#lsp').html('');
                    $('#lsp').html('' + response.data);


                },

                error: function () {
                    $('body')
                        .toast({
                            class: 'error',
                            message: 'An error occurred !'
                        })
                    ;
                }
            });


        }
        function openProduct() {
            window.open('{% url "homeApp:product" %}', 'popUpWindow', 'height=screen.availHeight,width=screen.availWidth,left=100,top=100,resizable=yes,scrollbars=yes,toolbar=yes,menubar=no,location=no,directories=no, status=yes');
        }
        function openCategory() {
            window.open('{% url "homeApp:hsn" %}', 'popUpWindow', 'height=screen.availHeight,width=screen.availWidth,left=100,top=100,resizable=yes,scrollbars=yes,toolbar=yes,menubar=no,location=no,directories=no, status=yes');
        }


        //post
        function saleLater() {
            var challNo = $('#challNo').val();
            var personalDiscount = $('#personalDiscount').html();
            var customerID = $('#customerID').val();
            var name = $('#customerName').val();
            var gst = $('#gst').val();
            var phone = $('#phone').val();
            var email = $('#email').val();
            var address = $('#address').val();
            var state = $('#state').val();
            var pType = $('#pType').val();
            var payment = $('input[name="payment"]:checked').val();
            var cDays = $('#cDays').val();
            var invoiceNumber = $('#invoiceNo').val();
            var pDate = $('#date').val();
            var chequeDetail = $('#chequeDetail').val();
            var deliveryNote = $('#deliveryNote').val();
            var supplierReference = $('#supplierReference').val();
            var orderNumber = $('#orderNumber').val();
            var dispatchNumber = $('#dispatchNumber').val();
            var dispatchThrough = $('#dispatchThrough').val();
            var otherReference = $('#otherReference').val();
            var dispatchNoteDate = $('#dispatchNoteDate').val();
            var destination = $('#destination').val();
            var company = $('#company').val();
            var paid = $('#paidMoney').val();
            var dueOrReturn = $('#dueOrReturn').val();
            var invoiceSeriesID = $('#invoiceSeriesID').val();
            var defaultInvoiceSeries = $('#defaultInvoiceSeries').html();
            var paidAgainstBill = $('#paidAgainstBill').val();

            var datas = '';
            $('#itemTable tbody tr').each(function () {
                var id = $(this).closest('tr').attr('id');
                var pro = $('#product' + id).html();
                var cat = $('#category' + id).html();
                var hs = $('#hsn' + id).html();
                var qty = $('#quantity' + id).html();
                var pri = $('#price' + id).html();
                var gs = $('#gst' + id).html();
                var netp = $('#netprice' + id).html();
                var tot = $('#total' + id).html();
                var dis = $('#disc' + id).html();
                var unit = $('#unit' + id).html();
                var description = $('#description' + id).html();

                datas = datas + '' + id + '|' + pro + '|' + cat + '|' + hs + '|' + qty + '|' + pri + '|' + gs + '|' + netp + '|' + tot + '|' + dis + '|' + unit + '|' + description + '@'


            });

            var subTotal = $('#subTotal').html();
            var taxable = $('#taxable').html();
            var totalFinal = $('#totalAfterGst').html();
            var roundOff = $('#roundOff').html();
            var taxableGST = $('#taxableGST').html();
            var bill_disc = $('#billDiscount').html();
            var otherCharges = $('#otherCharges').html();

            var GrandTotal = $('#GrandTotal').html();
            if (name === '' || pDate === '' || subTotal === '' || taxable === '' || totalFinal === '' ||
                roundOff === '' || taxableGST === '' || bill_disc === '' || GrandTotal === '' || datas === '') {
                $('body')
                    .toast({
                        class: 'orange',
                        message: 'Customer Name, Date, Items, total are required !'
                    })
                ;
            } else {
                data = new FormData();
                data.append('customerID', customerID);
                data.append('name', name);
                data.append('gst', gst);
                data.append('phone', phone);
                data.append('email', email);
                data.append('address', address);
                data.append('state', state);
                data.append('pType', pType);
                data.append('payment', payment);
                data.append('cDays', cDays);
                data.append('invoiceNumber', invoiceNumber);
                data.append('pDate', pDate);
                data.append('datas', datas);
                data.append('subTotal', subTotal);
                data.append('taxable', taxable);
                data.append('totalFinal', totalFinal);
                data.append('roundOff', roundOff);
                data.append('taxableGST', taxableGST);
                data.append('bill_disc', bill_disc);
                data.append('GrandTotal', GrandTotal);
                data.append('otherCharges', otherCharges);
                data.append('chequeDetail', chequeDetail);
                data.append('deliveryNote', deliveryNote);
                data.append('supplierReference', supplierReference);
                data.append('orderNumber', orderNumber);
                data.append('dispatchNumber', dispatchNumber);
                data.append('dispatchThrough', dispatchThrough);
                data.append('otherReference', otherReference);
                data.append('dispatchNoteDate', dispatchNoteDate);
                data.append('destination', destination);
                data.append('company', company);
                data.append('paid', paid);
                data.append('dueOrReturn', dueOrReturn);
                data.append('invoiceSeriesID', invoiceSeriesID);
                data.append('defaultInvoiceSeries', defaultInvoiceSeries);
                data.append('paidAgainstBill', paidAgainstBill);
                data.append('personalDiscount', personalDiscount);
                data.append('challNo', challNo);

                $.ajax({
                    type: 'post',
                    url: '/api/add_booking/',
                    data: data,
                    contentType: false,
                    cache: false,
                    processData: false,


                    success: function (response) {
                        if (response.message === 'success') {
                            $('body')
                                .toast({
                                    class: 'success',
                                    message: 'New Booking created Successfully.'
                                });

                            $('#itemTable tbody tr').remove();
                            $('#formtest').trigger('reset');
                            $('#formtest2').trigger('reset');
                            $('#formtest3').trigger('reset');
                            $('#AddCompanyForm').trigger('reset');
                            $('#subTotal').html('0.00');
                            $('#taxable').html('0.00');
                            $('#totalAfterGst').html('0.00');
                            $('#roundOff').html('0.00');
                            $('#taxableGST').html('0.00');
                            $('#billDiscount').html('0.00');

                            $('#GrandTotal').html('0.00');
                            $('#otherCharges').html('0.00');
                            $('#paidMoney').val('0');
                            $('#dueOrReturn').val('0');
                            $('#paidAgainstBill').val('0');
                            getInvoiceSeries();
                            var today = new Date();
                            $('#standard_calendar')
                                .calendar({
                                        initialDate: today.getDate() + '/' + (today.getMonth() + 1) + '/' + today.getFullYear(),
                                        monthFirst: false,
                                        type: 'date',
                                        formatter: {
                                            date: function (date, settings) {

                                                if (!date) return '';
                                                var day = String(date.getDate());
                                                var month = String(date.getMonth() + 1);
                                                var year = date.getFullYear();
                                                return day + '/' + month + '/' + year;
                                            }
                                        }
                                    }
                                );
                            changeProductType();


                        }
                        else {
                            $('body')
                                .toast({
                                    class: 'error',
                                    message: 'An error occurred !'
                                })
                            ;

                        }

                        return response;
                    },
                    error: function () {
                        $('body')
                            .toast({
                                class: 'error',
                                message: 'An error occurred !'
                            })
                        ;
                    }
                });


            }

        }


        function PrintOption() {

            $('#PrintOption')
                .modal('show')
            ;

        }

        function printInvoiceA4() {
            var ID = $('#printSaleID').val()
            window.open('/print/?q=' + ID, 'popUpWindow', 'height=screen.availHeight,width=screen.availWidth,left=100,top=100,resizable=yes,scrollbars=yes,toolbar=yes,menubar=no,location=no,directories=no, status=yes');


        }
        function printInvoiceA5() {
            var ID = $('#printSaleID').val()
            window.open('/print_invoicea5/?q=' + ID, 'popUpWindow', 'height=screen.availHeight,width=screen.availWidth,left=100,top=100,resizable=yes,scrollbars=yes,toolbar=yes,menubar=no,location=no,directories=no, status=yes');


        }
        function printBillA4() {
            var ID = $('#printSaleID').val()
            window.open('/printBill/?q=' + ID, 'popUpWindow', 'height=screen.availHeight,width=screen.availWidth,left=100,top=100,resizable=yes,scrollbars=yes,toolbar=yes,menubar=no,location=no,directories=no, status=yes');

        }
        function printBillA55() {
            var ID = $('#printSaleID').val()
            window.open('/print_billA5/?q=' + ID, 'popUpWindow', 'height=screen.availHeight,width=screen.availWidth,left=100,top=100,resizable=yes,scrollbars=yes,toolbar=yes,menubar=no,location=no,directories=no, status=yes');

        }
    </script>
{% endblock %}